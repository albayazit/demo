Bismillah
------------------------------------------------------
Maski v seti:
|MASK||HOSTS|   |IP|
/32	    1	    255.255.255.255
/31	    2	    255.255.255.254
/30	    4	    255.255.255.252
/29	    8	    255.255.255.248
/28	    16	    255.255.255.240
/27	    32	    255.255.255.224
/26	    64	    255.255.255.192
/25	    128	    255.255.255.128
/24	    256	    255.255.255.0
------------------------------------------------------
IP-address:
CLI - 10.10.10.2/24; ::ffff:a0a:a02.
ISP [port NAT] - [DHCP]
ISP [port ISP—CLI] - 10.10.10.1/24; ::ffff:a0a:a01/24
ISP [port ISP—HQ-R] - 2.2.2.1/24; ::ffff:202:201/24
ISP [port ISP—BR-R] - 3.3.3.1/24; ::ffff:303:301/24
HQ-R  [port HQ-R—ISP] - 2.2.2.2/24; ::ffff:202:202/24
HQ-R  [port HQ-R—HQ-SRV] - 20.20.20.1/26; ::ffff:1414:1401/26
HQ-SRV - 20.20.20.2/26 [Static DHCP по MAC]; ::ffff:1414:1402/26 [Static DHCP по MAC]
BR-R [port BR-R—ISP]- 3.3.3.2/24; ::ffff:303:301/24
BR-R [port BR-R—BR-SRV] - 30.30.30.1/28; ::ffff:1e1e:1e01/28
BR-SRV - 30.30.30.2/28; ::ffff:1e1e:1e02/28
------------------------------------------------------
Telegraph address:
https://telegra.ph/DEMO-Base-05-06
------------------------------------------------------
Scripts on server:
1. backup_script.sh - HQ-R, BR-R
2. isp.sh - ISP conf to iptables
3. dns.sh - HQ-SRV
4. ntp.sh - HQ-R
5. samba.sh - HQ-SRV
------------------------------------------------------
[MODULE_1]
----------------------------
I. Network
NE ZABUDb PRO GATEWAY
1. ISP
nano /etc/iptables.sh
<-
#!bin/bash
export WAN="enp0s3"
iptables -F
iptables -F -t nat
iptables -F -t mangle
iptables -X
iptables -X -t nat
iptables -X -t mangle

iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT

iptables -t nat -A POSTROUTING -o $WAN -j MASQUERADE

/sbin/iptables-save > /etc/iptables.rules
->
chmod 0740 /etc/iptables.sh
/etc/iptables.sh

2. nano /etc/network/interfaces
post-up iptables-restore < /etc/iptables.rules
----------------------------
II. FRR -  ISP, BR-R, HQ-R

apt-get install frr
1. nano /etc/frr/daemons           
ospfd=yes                       

2. nano /etc/frr/frr.conf          
router ospf                     
ospf router-id <router_ip>       
network 11.11.11.0/24 area 0.0.0.0
network <area_ip>/<mask> area 0.0.0.0

 3. nano /etc/sysctl.conf
net.ipv4.ip_forward=1
 4. sysctl -p
 5. reboot

vtysh -c 'show ip ospf neighbor' - proverka

GRE-TUNNEL on BR-R and HQ-R
nano /etc/gre.tun

[HQ-R]
#!/bin/bash
ip tunnel del gre1
ip tunnel add gre1 mode gre remote 3.3.3.2 local 2.2.2.2 ttl 255
ip addr add 1.1.1.1/30 peer 1.1.1.2/30 dev gre1
ip link set gre1 up

[BR-R]
#!/bin/bash
ip tunnel del gre1
ip tunnel add gre1 mode gre remote 2.2.2.2 local 3.3.3.2 ttl 255
ip addr add 1.1.1.2/30 peer 1.1.1.1/30 dev gre1
ip link set gre1 up

nano /etc/network/interfaces

post-up /etc/gre.tun
----------------------------
III. DHCP - HQ-R
apt-get install isc-dhcp-server

nano /etc/default/isc-dhcp-server
enp0s8 - interfaces to BR-SRV

nano /etc/dhcp/dhcpd.conf

subnet 20.20.20.0 netmask 255.255.255.192 (mojet drugoi) {
  range 20.20.20.3 20.20.20.62;
  option routers 20.20.20.1;
  option domain-name-servers 8.8.8.8;
}

host hq_srv {
  hardware ethernet <mac-address>;
  fixed-address 20.20.20.2;
}
------------------------------------------------------
